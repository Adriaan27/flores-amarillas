<!DOCTYPE html>
<html>
  <head>
    <title>Flores Amarillas üåº | Para Ti</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body { 
        margin: 0; 
        overflow: hidden;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      
      #msg {
        position: absolute;
        bottom: 30px;
        width: 100%;
        text-align: center;
        font-size: 1.8em;
        color: #FFD700;
        font-family: 'Georgia', serif;
        text-shadow: 3px 3px 10px rgba(0,0,0,0.7);
        z-index: 10;
        animation: pulse 2s ease-in-out infinite;
        letter-spacing: 2px;
      }
      
      @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
      }
      
      .flower {
        position: fixed;
        top: -50px;
        font-size: 30px;
        color: #FFD700;
        animation: fall linear infinite;
        filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
        z-index: 5;
      }
      
      @keyframes fall {
        to {
          transform: translateY(110vh) rotate(360deg);
        }
      }
      
      .petal {
        position: fixed;
        width: 15px;
        height: 20px;
        background: linear-gradient(45deg, #FFD700, #FFA500);
        border-radius: 0 50% 50% 50%;
        animation: petalFall linear infinite;
        opacity: 0.8;
      }
      
      @keyframes petalFall {
        0% {
          transform: translateY(-20px) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 0.8;
        }
        90% {
          opacity: 0.8;
        }
        100% {
          transform: translateY(110vh) rotate(720deg);
          opacity: 0;
        }
      }
      
      .heart {
        position: fixed;
        color: #ff69b4;
        font-size: 20px;
        animation: floatHeart 8s infinite ease-in-out;
        opacity: 0.6;
      }
      
      @keyframes floatHeart {
        0%, 100% { 
          transform: translateY(0) translateX(0) scale(1); 
          opacity: 0;
        }
        10% {
          opacity: 0.6;
        }
        50% { 
          transform: translateY(-50vh) translateX(30px) scale(1.2); 
          opacity: 0.8;
        }
        90% {
          opacity: 0.6;
        }
      }
      
      /* Panel de control */
      .control-panel {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(255, 255, 255, 0.9);
        padding: 15px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        z-index: 100;
        text-align: center;
        max-width: 90%;
      }
      
      .control-panel h3 {
        color: #764ba2;
        margin-bottom: 10px;
        font-size: 1.2em;
      }
      
      .btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s;
      }
      
      .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }
      
      .btn.active {
        background: #FFD700;
        color: #333;
      }
      
      /* Modal para el marcador */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        z-index: 200;
        justify-content: center;
        align-items: center;
      }
      
      .modal-content {
        background: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        max-width: 400px;
        margin: 20px;
      }
      
      .modal img {
        width: 100%;
        max-width: 300px;
        margin: 15px 0;
        border: 2px solid #764ba2;
        border-radius: 10px;
      }
      
      .close-modal {
        background: #ff4444;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        margin-top: 10px;
      }
      
      /* Vista 3D sin AR */
      #view3d {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 500px;
        height: 60vh;
        z-index: 50;
      }
      
      .ar-status {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255,255,255,0.9);
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.9em;
        z-index: 90;
      }
      
      .ar-status.scanning {
        color: orange;
      }
      
      .ar-status.found {
        color: green;
      }
    </style>
  </head>
  <body>
    <!-- Panel de control -->
    <div class="control-panel">
      <h3>üåª Ramo de Flores Amarillas üåª</h3>
      <button class="btn" onclick="showMarkerModal()">üì± Ver Marcador AR</button>
      <button class="btn" onclick="toggleView()">üåº Ver Ramo 3D</button>
      <button class="btn" onclick="toggleMusic()">üéµ M√∫sica</button>
    </div>
    
    <!-- Estado de AR -->
    <div class="ar-status scanning" id="arStatus">
      üì∑ Buscando marcador...
    </div>
    
    <!-- Modal del marcador -->
    <div class="modal" id="markerModal">
      <div class="modal-content">
        <h3>üì± Marcador HIRO</h3>
        <p>Muestra este marcador a tu c√°mara:</p>
        <img src="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" alt="HIRO Marker">
        <p style="font-size: 0.9em; color: #666;">
          Puedes imprimirlo o mostrarlo en otra pantalla
        </p>
        <a href="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png" download="hiro-marker.png" class="btn">
          ‚¨áÔ∏è Descargar Marcador
        </a>
        <br>
        <button class="close-modal" onclick="closeMarkerModal()">Cerrar</button>
      </div>
    </div>
    
    <div id="msg">üíõ Este ramo es para ti üåª</div>
    
    <!-- Audio de fondo (opcional) -->
    <audio id="bgMusic" loop>
      <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <!-- Script para animaciones y controles -->
    <script>
      let view3DActive = false;
      let musicPlaying = false;
      
      // Mostrar modal del marcador
      function showMarkerModal() {
        document.getElementById('markerModal').style.display = 'flex';
      }
      
      // Cerrar modal del marcador
      function closeMarkerModal() {
        document.getElementById('markerModal').style.display = 'none';
      }
      
      // Toggle vista 3D
      function toggleView() {
        view3DActive = !view3DActive;
        const view3d = document.getElementById('view3d');
        const arScene = document.getElementById('arScene');
        const btn = event.target;
        
        if (view3DActive) {
          view3d.style.display = 'block';
          arScene.style.opacity = '0';
          btn.classList.add('active');
          btn.textContent = 'üì∑ Ver en AR';
        } else {
          view3d.style.display = 'none';
          arScene.style.opacity = '1';
          btn.classList.remove('active');
          btn.textContent = 'üåº Ver Ramo 3D';
        }
      }
      
      // Toggle m√∫sica
      function toggleMusic() {
        const music = document.getElementById('bgMusic');
        const btn = event.target;
        musicPlaying = !musicPlaying;
        
        if (musicPlaying) {
          // Por ahora sin m√∫sica real, solo efecto visual
          btn.classList.add('active');
          btn.textContent = 'üîá Silenciar';
        } else {
          btn.classList.remove('active');
          btn.textContent = 'üéµ M√∫sica';
        }
      }
      
      // Detectar cuando se encuentra el marcador
      document.addEventListener('DOMContentLoaded', function() {
        const scene = document.querySelector('a-scene');
        const marker = document.querySelector('a-marker');
        const arStatus = document.getElementById('arStatus');
        
        if (marker) {
          marker.addEventListener('markerFound', function() {
            arStatus.textContent = '‚úÖ ¬°Marcador detectado!';
            arStatus.classList.remove('scanning');
            arStatus.classList.add('found');
            
            // Vibrar si est√° disponible
            if (navigator.vibrate) {
              navigator.vibrate(200);
            }
          });
          
          marker.addEventListener('markerLost', function() {
            arStatus.textContent = 'üì∑ Buscando marcador...';
            arStatus.classList.remove('found');
            arStatus.classList.add('scanning');
          });
        }
      });
      
      // Crear flores cayendo
      function createFlower() {
        const flowers = ['üåº', 'üåª', 'üå∫', 'üíõ'];
        const flower = document.createElement("div");
        flower.classList.add("flower");
        flower.innerHTML = flowers[Math.floor(Math.random() * flowers.length)];
        flower.style.left = Math.random() * 100 + "vw";
        flower.style.animationDuration = (4 + Math.random() * 6) + "s";
        flower.style.fontSize = (20 + Math.random() * 20) + "px";
        document.body.appendChild(flower);

        setTimeout(() => flower.remove(), 10000);
      }
      
      // Crear p√©talos cayendo
      function createPetal() {
        const petal = document.createElement("div");
        petal.classList.add("petal");
        petal.style.left = Math.random() * 100 + "vw";
        petal.style.animationDuration = (5 + Math.random() * 5) + "s";
        petal.style.animationDelay = Math.random() * 2 + "s";
        document.body.appendChild(petal);

        setTimeout(() => petal.remove(), 12000);
      }
      
      // Crear corazones flotantes
      function createHeart() {
        const heart = document.createElement("div");
        heart.classList.add("heart");
        heart.innerHTML = "üíï";
        heart.style.left = (10 + Math.random() * 80) + "vw";
        heart.style.bottom = "10px";
        heart.style.animationDelay = Math.random() * 3 + "s";
        document.body.appendChild(heart);

        setTimeout(() => heart.remove(), 8000);
      }
      
      // Iniciar animaciones
      setInterval(createFlower, 600);
      setInterval(createPetal, 800);
      setInterval(createHeart, 3000);
      
      // Cambiar mensaje cada cierto tiempo
      const messages = [
        "üíõ Este ramo es para ti üåª",
        "üåº Flores amarillas como el sol üåû",
        "üíê Siempre floreces donde est√°s üå∫",
        "üåª Tu sonrisa ilumina como estas flores üíõ",
        "üåº Un jard√≠n de alegr√≠as para ti üå∏"
      ];
      
      let msgIndex = 0;
      setInterval(() => {
        msgIndex = (msgIndex + 1) % messages.length;
        document.getElementById('msg').innerHTML = messages[msgIndex];
      }, 4000);
    </script>

    <!-- Componentes personalizados para A-Frame -->
    <script>
      // Componente para movimiento suave tipo brisa
      AFRAME.registerComponent('sway', {
        schema: {
          speed: {default: 1},
          amplitude: {default: 5}
        },
        tick: function (time) {
          const el = this.el;
          const speed = this.data.speed;
          const amplitude = this.data.amplitude;
          el.object3D.rotation.z = Math.sin(time * 0.001 * speed) * amplitude * Math.PI / 180;
          el.object3D.rotation.x = Math.sin(time * 0.001 * speed * 0.7) * amplitude * 0.5 * Math.PI / 180;
        }
      });
      
      // Componente para flotar suavemente
      AFRAME.registerComponent('float', {
        schema: {
          speed: {default: 1},
          amplitude: {default: 0.1}
        },
        tick: function (time) {
          const el = this.el;
          const speed = this.data.speed;
          const amplitude = this.data.amplitude;
          el.object3D.position.y = Math.sin(time * 0.001 * speed) * amplitude;
        }
      });
    </script>

    <!-- Vista 3D sin AR -->
    <a-scene id="view3d" embedded>
      <a-sky color="#87CEEB"></a-sky>
      
      <!-- Luz ambiental -->
      <a-light type="ambient" color="#ffffff" intensity="0.5"></a-light>
      <a-light type="directional" color="#FFD700" position="2 4 2" intensity="0.5"></a-light>
      
      <!-- Ramo de flores (copia del de AR) -->
      <a-entity id="bouquet3d" position="0 0 -3" scale="2 2 2">
        <!-- Usar el mismo contenido del ramo AR -->
        <a-cylinder radius="0.02" height="0.8" color="#228B22" position="0 -0.4 0"></a-cylinder>
        <a-sphere radius="0.15" color="#8B4513" position="0 0 0"></a-sphere>
        
        <!-- P√©talos principales -->
        <a-plane width="0.1" height="0.3" color="#FFD700" position="0.2 0 0" rotation="0 0 -30" side="double" sway="speed: 1.2; amplitude: 3"></a-plane>
        <a-plane width="0.1" height="0.3" color="#FFD700" position="-0.2 0 0" rotation="0 0 30" side="double" sway="speed: 1.2; amplitude: 3"></a-plane>
        <a-plane width="0.1" height="0.3" color="#FFEA00" position="0 0.2 0" rotation="0 0 0" side="double" sway="speed: 1; amplitude: 4"></a-plane>
        <a-plane width="0.1" height="0.3" color="#FFEA00" position="0 -0.2 0" rotation="0 0 180" side="double" sway="speed: 1; amplitude: 4"></a-plane>
        
        <!-- Animaci√≥n de rotaci√≥n -->
        <a-animation attribute="rotation" to="0 360 0" dur="15000" repeat="indefinite" easing="linear"></a-animation>
      </a-entity>
      
      <!-- C√°mara -->
      <a-camera position="0 1 0"></a-camera>
    </a-scene>

    <!-- Escena AR principal -->
    <a-scene 
      id="arScene"
      embedded 
      arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true; precision: medium;">
      
      <a-marker preset="hiro" id="mainMarker">
        <!-- Grupo principal del ramo -->
        <a-entity id="bouquet" position="0 0.5 0">
          
          <!-- Girasol central grande -->
          <a-entity>
            <a-cylinder radius="0.02" height="0.8" color="#228B22" position="0 -0.4 0"></a-cylinder>
            <a-sphere radius="0.15" color="#8B4513" position="0 0 0"></a-sphere>
            
            <!-- P√©talos del girasol central -->
            <a-plane width="0.1" height="0.3" color="#FFD700" position="0.2 0 0" rotation="0 0 -30" side="double" sway="speed: 1.2; amplitude: 3"></a-plane>
            <a-plane width="0.1" height="0.3" color="#FFD700" position="-0.2 0 0" rotation="0 0 30" side="double" sway="speed: 1.2; amplitude: 3"></a-plane>
            <a-plane width="0.1" height="0.3" color="#FFEA00" position="0 0.2 0" rotation="0 0 0" side="double" sway="speed: 1; amplitude: 4"></a-plane>
            <a-plane width="0.1" height="0.3" color="#FFEA00" position="0 -0.2 0" rotation="0 0 180" side="double" sway="speed: 1; amplitude: 4"></a-plane>
            <a-plane width="0.1" height="0.3" color="#FFD700" position="0.14 0.14 0" rotation="0 0 -45" side="double" sway="speed: 1.3; amplitude: 3"></a-plane>
            <a-plane width="0.1" height="0.3" color="#FFD700" position="-0.14 0.14 0" rotation="0 0 45" side="double" sway="speed: 1.3; amplitude: 3"></a-plane>
            <a-plane width="0.1" height="0.3" color="#FFEA00" position="0.14 -0.14 0" rotation="0 0 -135" side="double" sway="speed: 1.1; amplitude: 4"></a-plane>
            <a-plane width="0.1" height="0.3" color="#FFEA00" position="-0.14 -0.14 0" rotation="0 0 135" side="double" sway="speed: 1.1; amplitude: 4"></a-plane>
          </a-entity>
          
          <!-- Girasol izquierdo -->
          <a-entity position="-0.4 -0.1 0.1" rotation="0 0 -15">
            <a-cylinder radius="0.015" height="0.6" color="#228B22" position="0 -0.3 0"></a-cylinder>
            <a-sphere radius="0.1" color="#8B4513" position="0 0 0" float="speed: 1.5; amplitude: 0.05"></a-sphere>
            <a-plane width="0.08" height="0.2" color="#FFD700" position="0.12 0 0" side="double" sway="speed: 1.4; amplitude: 5"></a-plane>
            <a-plane width="0.08" height="0.2" color="#FFD700" position="-0.12 0 0" side="double" sway="speed: 1.4; amplitude: 5"></a-plane>
            <a-plane width="0.08" height="0.2" color="#FFEA00" position="0 0.12 0" side="double" sway="speed: 1.2; amplitude: 6"></a-plane>
            <a-plane width="0.08" height="0.2" color="#FFEA00" position="0 -0.12 0" side="double" sway="speed: 1.2; amplitude: 6"></a-plane>
          </a-entity>
          
          <!-- Girasol derecho -->
          <a-entity position="0.4 -0.1 0.1" rotation="0 0 15">
            <a-cylinder radius="0.015" height="0.6" color="#228B22" position="0 -0.3 0"></a-cylinder>
            <a-sphere radius="0.1" color="#8B4513" position="0 0 0" float="speed: 1.3; amplitude: 0.05"></a-sphere>
            <a-plane width="0.08" height="0.2" color="#FFD700" position="0.12 0 0" side="double" sway="speed: 1.6; amplitude: 5"></a-plane>
            <a-plane width="0.08" height="0.2" color="#FFD700" position="-0.12 0 0" side="double" sway="speed: 1.6; amplitude: 5"></a-plane>
            <a-plane width="0.08" height="0.2" color="#FFEA00" position="0 0.12 0" side="double" sway="speed: 1.3; amplitude: 6"></a-plane>
            <a-plane width="0.08" height="0.2" color="#FFEA00" position="0 -0.12 0" side="double" sway="speed: 1.3; amplitude: 6"></a-plane>
          </a-entity>
          
          <!-- Hojas decorativas -->
          <a-plane width="0.08" height="0.15" color="#228B22" position="-0.25 -0.4 0" rotation="0 0 -45" side="double" sway="speed: 0.8; amplitude: 2"></a-plane>
          <a-plane width="0.08" height="0.15" color="#228B22" position="0.25 -0.4 0" rotation="0 0 45" side="double" sway="speed: 0.8; amplitude: 2"></a-plane>
          
          <!-- Animaci√≥n de rotaci√≥n suave -->
          <a-animation attribute="rotation" to="0 360 0" dur="20000" repeat="indefinite" easing="linear"></a-animation>
        </a-entity>
        
        <!-- Texto 3D -->
        <a-text value="Para Ti" color="#FFD700" position="0 1.2 0" align="center" width="3" font="kelsonsans"
                animation="property: position; to: 0 1.4 0; dir: alternate; dur: 2000; loop: true; easing: easeInOutSine">
        </a-text>
        
        <!-- Part√≠culas de luz -->
        <a-sphere radius="0.02" color="#FFFACD" position="0.3 0.8 0.2" 
                  material="emissive: #FFFACD; emissiveIntensity: 0.5"
                  animation="property: position; to: -0.3 0.2 -0.2; dir: alternate; dur: 3000; loop: true">
        </a-sphere>
        <a-sphere radius="0.02" color="#FFFACD" position="-0.3 0.6 -0.2" 
                  material="emissive: #FFFACD; emissiveIntensity: 0.5"
                  animation="property: position; to: 0.3 0.9 0.2; dir: alternate; dur: 3500; loop: true">
        </a-sphere>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
